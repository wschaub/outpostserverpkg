
<p>
The plan right now is based on what I have been told, that there will be a location with grid power that will be using Efika smart tops and have the Rocket M5 base station. This location will have a smart top that has pretty much the same software on it as the smart top being used as a standalone server at the remote location (the one with solar power)
</p>

<p>
The idea is to have a simple wireless router/access point at the remote end that has the point to point wireless link to the base station set up as the <acronym title="Wide Area Network">WAN</acronym> link and a basic RFC1918 IP range behind NAT for the <acronym title="Local Area Network">LAN</acronym>. I will probably not have the router give out <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> or do local <acronym title="Domain Name System">DNS</acronym> because we can easily use a solution like DNSMasq to provide this on the smart top that will be acting as the standalone server anyway.
</p>

<p>
The standalone server will run samba and lightttpd and make the samba share available over http as well. in addition to this simple arrangement I will provide an install of docuwiki which can be used quite easily by the end users to create their own searchable and organized content. I believe it has already been translated to a number of languages and should be easy to translate if the desired language is not available yet.
</p>

<p>
There will also be a link to the current status of the solar power system and an audio alarm that will sound using the smart top&#039;s built in speaker if the  battery state goes down to red.
(this is because we can&#039;t use the load terminals to cut us off like I wanted to because they are designed only for DC to DC loads and can be damaged if an inverter is used. (thankfully I don&#039;t think we broke anything during testing.)
</p>

<p>
The following picture is a rough sketch of how I see it working for the pilot project and only shows the base station and the remote site (assuming reality allows us to set up that point to point link)
</p>

<p>
<img src="/wiki/lib/exe/fetch.php?media=outpostdocs:tznetwork.png" class="media" alt="" />
</p>

<p>
This second sketch shows how I see it working for more than one remote site (assuming the equipment lets us brigde more than one remote site to the base station.)
</p>

<p>
<img src="/wiki/lib/exe/fetch.php?media=outpostdocs:p2p.png" class="media" alt="" />
</p>

<h5><a name="update" id="update">UPDATE:</a></h5>
<div class="level5">

<p>
The only place we need an extra router will likely be at the central location where the base station is located. I have a test setup right now that seems to work just fine for our purposes. The setup is at the central location we have the base station set up to be a point to multipoint AP and have its networking config set up to bridge the main <acronym title="Local Area Network">LAN</acronym> over that link.
The main <acronym title="Local Area Network">LAN</acronym> has an IP range of 192.168.93.x (we can change the numbering if you like) and has smart top #1 running:DNSmasq (for <acronym title="Domain Name System">DNS</acronym> and <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>), lighttpd (for serving up static web content as well as <acronym title="Hypertext Preprocessor">PHP</acronym>),dokuwiki, and samba. 
</p>

<p>
All remote locations will get a 192.168.93.x IP assigned to their point to point link (<acronym title="Wide Area Network">WAN</acronym> side) because of the bridging going on at the base station. On the <acronym title="Local Area Network">LAN</acronym> side of the remote locations all the networks will be 192.168.23.x and be behind NAT. the 192.168.93.x IP grabbed by the wireless side of the AirGridM5 will port forward ssh and perhaps a few other ports to 192.168.23.2 which will be another smart top that lives at the remote site and runs exactly the same software so that that site can be self contained if necessary.
</p>

<p>
the nonexistent .tznet domain will be served up by dnsmasq in addition <acronym title="Domain Name System">DNS</acronym> will resolve the <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> provided host names of anything that has a current lease.  
</p>

</div>

<h5><a name="software" id="software">Software</a></h5>
<div class="level5">

<p>
Each site will have it&#039;s own name I&#039;m not feeling particularly creative right now so lets call them main and remote1 (with remote2 as a fictional 3rd site)
</p>

<p>
Each site has at it&#039;s heart an Efika MX smart top running DNSMasq for <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym>/<acronym title="Domain Name System">DNS</acronym> and lighttpd and samba for filesharing
</p>

<p>
DNSMasq will use /etc/hosts + current <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> leases to populate the <acronym title="Domain Name System">DNS</acronym> entries for *.tznet
</p>

<p>
main.tznet will always point to the smart top based web/file server at the central location
and will be reachable from the remote sites so long as their wireless link is available/possible.
</p>

<p>
local.tznet will be in /etc/hosts on each remote site and always point to that site&#039;s server
(192.168.23.2 always, except at the main site which points it to 192.168.93.2 instead)
</p>

<p>
/etc/resolv.conf on each remote site&#039;s smart top (used by DNSMasq to handle queries about hosts it does not know about) will have an entry (after localhost) pointing to main.tznet
which should know the names of all the remote sites (The remote site names are taken care of by changing the hostname used by the <acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> client on the airgridM5 hardware used at the remote sites.)
</p>

<p>
Using the correct port forwards on the remote sites will mean that anyone can talk to any of the remote site&#039;s servers by just hitting sitename.tznet from a browser. 
</p>

<p>
I have a working although not final version of the configs and software attached to this document as outpostpkg-version.tgz
</p>

<p>
Full documentation on how to set up the server software is included inside the README file inside the tarball. make sure you
always use the most recent version available. (I am working on 0.2 right now that includes a fix mentioned below, I expect to go through at least 2 more versions of this tarball before we hit the final version that ships to africa as there are some minor things to add like solar system status/<acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> lease table info pages and some initial content to be pre-loaded into the system)
</p>

</div>

<h5><a name="rsync" id="rsync">rsync</a></h5>
<div class="level5">

<p>
I have an idea that I hope to perfect before I run out of time
and that is to use rsync to keep everyone&#039;s site up to date if possible. 
</p>

<p>
<del>Basically on the main server you will have an incoming folder that will contain directories named after each site so /path/to/sharedstorage/incoming/remote1.tznet/upload and
/path/to/sharedstorage/incoming/remote1.tznet/wiki

upload would contain anything put in that site&#039;s upload folder at their location and would be rsynced with a cron script. the wiki directory would be the contents of their dokuwiki and could possibly somehow end up in a dokuwiki namespace named after that site (read only of course) 

on the remote end there would be a mirror directory that would contain a mirror of all the main site&#039;s files + the files from the other sites that ended up in incoming and a similar deal with a namespace in the wiki that gives you access to whats going on at other sites.

I&#039;m thinking I can do all of this with some simple shell scripts and a few symlinks here and there but I need to test if this is feasible and figure a way to make it happen in a sneakernet situation.</del>
</p>

<p>
NOTE:
I just did some tests and while dokuwiki can be manipulated in this way the biggest problem comes with the internal document links
and the location of media files which are stored in a different directory tree from the text files.
I would have to correct the location of the media files AND fix the links in the synced wiki article documents as part of the script.
</p>

<p>
So I came up with a much easier solution as a workaround:
/var/www/wiki is the wiki location
/var/www/shared is the read-write public samba share 
/var/www/mirror is where things are mirrored and is the location of a read-only samba share
</p>

<p>
a script runs on the main site that greps /var/lib/misc/dnsmasq.leases for MAC addresses that belong to ubiquity networks devices
and uses that to build a list of remote sites it then goes through and pulls up through rsync remotesite:/var/www/wiki and remotesite:/var/www/shared into /var/www/mirror/remotesite.tznet
</p>

<p>
Once it is done pulling the remote sites into it&#039;s mirror it then pushes back /var/www/mirrror to each remote site&#039;s /var/www/mirror using rsync (excluding /var/www/mirror/remotesite.tznet from the transfer)
</p>

<p>
Look inside the outpostserverpkg tarball to see how it all works.
</p>

<p>
At the very least even if I don&#039;t get rsync working due to time constraints we will at the very least have the following accessible at all sites:
</p>

<p>
a dokuwiki and a shared drive using samba that can also be accessed over the web
by hitting local.tznet/wiki or local.tznet/shared and a simple index.html that gives links to both. on sites that have solar power /status should have the state of the solar power system
</p>

<p>
I also plan to use the status information to sound an audio alarm when the battery state gets too low. 
</p>

</div>

<h5><a name="future_plans" id="future_plans">Future plans</a></h5>
<div class="level5">
<ul>
<li class="level1"><div class="li"> working local email</div>
</li>
<li class="level1"><div class="li"> some sort of chat software</div>
</li>
<li class="level1"><div class="li"> a distributed BBS system (see <a href="http://teotwawki.steubentech.com" class="urlextern" title="http://teotwawki.steubentech.com"  rel="nofollow">http://teotwawki.steubentech.com</a>)</div>
</li>
<li class="level1"><div class="li"> a calendaring system</div>
</li>
<li class="level1"><div class="li"> make most of this work over a sneakernet and include the ability to request a selection of sites to be subscribed to for viewing over a local proxy cache (updated by the sneakernet)</div>
</li>
</ul>

<p>
see <a href="http://www.wizzy.org.za/" class="urlextern" title="http://www.wizzy.org.za/"  rel="nofollow">http://www.wizzy.org.za/</a> for a working implementation that is already in the wild in africa.
</p>

</div>

<h5><a name="network_setup_instructions" id="network_setup_instructions">Network setup instructions</a></h5>
<div class="level5">

<p>
All of the hardware has been set up and the configuration backup files have been posted to this wiki
never the less I will document the setup in this section and include screen shots, management IP addresses
and username/password info.
</p>

<p>
<strong>main.tznet site (classroom with grid power and the site of the base station):</strong>
</p>
<ul>
<li class="level1"><div class="li"> 192.168.93.1 linksys WRT54GS version 6 (running DD-WRT) MAC address 00:40:10:20:00:02 username admin password tznet</div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> 192.168.93.2 Efika MX smart top sys1.tznet, main.tznet MAC address 70:71:bc:9d:a5:6b username sys1 password sys1</div>
</li>
<li class="level1"><div class="li"> 192.168.93.??? (<acronym title="Dynamic Host Configuration Protocol">DHCP</acronym> assigned) Rocket M5 base station hostname UBNT MAC address 01:00:27:22:16:d6:8c username ubnt password ubnt</div>
</li>
</ul>

<p>
    you can find out the IP by logging into sys1 and running cat /var/lib/misc/dnsmasq.leases
</p>

<p>
<strong>remote1.tznet site (remote location with solar power):</strong>
</p>
<ul>
<li class="level1"><div class="li"> 192.168.23.1 AirGrid M5 wireless point to point link/router. user name ubnt password ubnt fallback IP 192.168.1.50 MAC address 00:27:22:0f:b2:ff</div>
</li>
<li class="level1"><div class="li"> 192.168.23.2 Efika MX smart top hostnames local.tznet, sys2.tznet,remote1.tznet (this last one is the 192.168.93.x IP of the airgrid but it port forwards to the Efika) username sys2 password sys2</div>
</li>
<li class="level1"><div class="li"> 192.168.93.3 D-Link AirplusG DWL-G700AP ssid = tznetremote1 username = admin password = no password</div>
</li>
</ul>

</div>

<h5><a name="client_computer_setup_maverick_brain_damage" id="client_computer_setup_maverick_brain_damage">Client Computer setup (maverick brain damage)</a></h5>
<div class="level5">

<p>
On maverick you can not browse the gnome equivalent of the network neighborhood without modifying
/etc/samba/smb.conf slightly
the fixed version of the smb.conf has the following line in it that seems to fix the issues I was having
with browsing for windows file shares on Maverick in Gnome 
</p>
<pre class="code">name resolve order = lmhosts wins bcast host</pre>

<p>
The fixed smb.conf file is included in the outpostserverpkg tarball in version 0.2 and higher.
</p>

</div>

<h5><a name="notes" id="notes">NOTES</a></h5>
<div class="level5">

<p>
I should have the non local resolv.conf stuff in another file that only dnsmasq reads so there is zero delay with the main site down.
should be a quick (i&#039;ve used the same config at home)
</p>

</div>

<h5><a name="important_files" id="important_files">Important files</a></h5>
<div class="level5">

<p>
Everything can be found at <a href="http://local.tznet/shared/outpostdocs/software/genesi/" class="urlextern" title="http://local.tznet/shared/outpostdocs/software/genesi/"  rel="nofollow">http://local.tznet/shared/outpostdocs/software/genesi/</a>
</p>
<ul>
<li class="level1"><div class="li"> outpostserverpkg-*.tgz these files contain the software and instructions needed to set up a new server or re-install an existing one (always use the highest version!)</div>
</li>
<li class="level1"><div class="li"> .cfg,.dat and .bin files These files are backups of the router configs for the equipment that they are named after.</div>
</li>
<li class="level1"><div class="li"> genesi-sunsaver-*.tgz  This is the software that logs the status of the solar system always use the highest numbered version.</div>
</li>
</ul>

</div>
